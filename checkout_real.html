
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Closette Studios</title>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <!-- Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <style>
      @keyframes fade-in-down {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in-down {
    animation: fade-in-down 0.3s ease-out;
  }

    /* Background and container */
    body {
      background-image: url('https://i.pinimg.com/originals/ff/0a/6b/ff0a6b58cebb6012dbd8f69f39453f12.jpg');
      background-size: cover;
      background-attachment: fixed;
      font-family: 'Inter', sans-serif;
    }

    .form-container {
      backdrop-filter: blur(20px);
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 16px;
    }

    /* Responsive tweaks */
    @media (max-width: 640px) {
      h2 { font-size: 1.5rem; }
      label, input, textarea, button { font-size: 0.85rem !important; }
      .form-container { padding: 1.25rem !important; }
      #order-summary li { font-size: 0.8rem; }
      #total-amount { font-size: 1rem; }
    }
  </style>
</head>

<body class="text-gray-800">
  <div class="min-h-screen flex items-center justify-center px-2 sm:px-4 py-6">
    <div class="max-w-2xl w-full form-container p-6 sm:p-8 shadow-xl">
      <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-center text-pink-600">Complete Your Order</h2>

      <!-- Checkout Form -->
      <form id="checkout-form" class="space-y-4">
        <div>
          <label class="block font-medium">Full Name</label>
          <input type="text" name="name" required class="w-full border border-gray-300 px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-400">
        </div>

        <div>
          <label class="block font-medium">Email</label>
          <input type="email" name="email" required class="w-full border border-gray-300 px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-400">
        </div>

        <div>
          <label class="block font-medium">Phone Number</label>
          <input type="text" name="phone" required class="w-full border border-gray-300 px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-400">
        </div>

        <div>
  <label class="block font-medium">Instagram Handle</label>
  <input type="text" name="instagram" placeholder=""
    class="w-full border border-gray-300 px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-400">
</div>


        <div>
          <label class="block font-medium">Shipping Address</label>
          <textarea name="address" rows="3" required class="w-full border border-gray-300 px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-400"></textarea>
        </div>

       <div>
  <label class="block font-medium">Coupon Code</label>
  <input type="text" id="couponCode" name="coupon"
    class="w-full border border-gray-300 px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-400">
  <button type="button" onclick="applyCoupon()"
    class="mt-2 px-4 py-2 bg-pink-500 text-white rounded hover:bg-pink-600 transition">Apply Coupon</button>
  <p id="couponMessage" class="text-sm mt-1 text-green-600 hidden">Coupon applied successfully!</p>
</div>





        <!-- Order Summary -->
        <div class="bg-pink-50 border border-pink-200 p-4 rounded-md">
          <h3 class="font-semibold mb-2 text-pink-600">Order Summary</h3>
          <hr>
          <ul id="order-summary" class="text-sm space-y-1"></ul>
          <div class="text-sm text-gray-600 mt-1">
            <hr>
            <p>Includes:</p>
              <p>Delivery: ₹100</p>
              <p>Platform Fee: ₹100</p>
          </div>
          <hr>
          <p class="text-lg font-semibold">Total: ₹<span id="total-amount">0</span></p>

        </div>

        <button id="payBtn" type="button" class="w-full bg-pink-600 text-white py-2 rounded-md hover:bg-pink-700 transition">
          Pay Now
        </button>
      </form>
    </div>
  </div>

<script>


  let total = 0;
  let couponApplied = false;
  const cartData = JSON.parse(localStorage.getItem("cartItems")) || [];

  const orderSummary = document.getElementById("order-summary");
  const totalAmountEl = document.getElementById("total-amount");

  // Calculate total
  cartData.forEach(item => {
    const itemTotal = item.price || 0;
    total += itemTotal;
    total += 200; // delivery + platform charges

    const li = document.createElement("li");
    li.textContent = `${item.title} - ₹${itemTotal}`;
    orderSummary.appendChild(li);
  });

  totalAmountEl.textContent = total;

  function applyCoupon() {

    const input = document.getElementById("couponCode").value.trim().toUpperCase();
    const message = document.getElementById("couponMessage");

    if (input === "TEST2") {
      couponApplied = true;
      totalAmountEl.textContent = 2;
      message.textContent = "Coupon applied successfully!";
      message.classList.remove("text-red-600");
      message.classList.add("text-green-600");
    } else {
      couponApplied = false;
      message.textContent = "Invalid coupon code";
      message.classList.remove("text-green-600");
      message.classList.add("text-red-600");
    }

    message.classList.remove("hidden");
  }

  document.getElementById("payBtn").onclick = function (e) {
    e.preventDefault();

    const form = document.getElementById("checkout-form");
    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    const formData = new FormData(form);
    const finalTotal = couponApplied ? 2 : total;

    const rzp = new Razorpay({
      key: "rzp_live_T7akzF7u5XQxtO",
      amount: finalTotal * 100,
      currency: "INR",
      name: "Closette Studios",
      description: "Outfit Collection",
      image: "logo.png",
      handler: function (response) {

        sendEmailAndRedirect(finalTotal);
      },
      prefill: {
        name: formData.get("name"),
        email: formData.get("email")
      },
      theme: {
        color: "#fcbad3"
      }
    });

    rzp.open();
  };

  function sendEmailAndRedirect(totalAmount) {
    emailjs.init("V2PB7KHpork0EN66Y");
    const form = document.getElementById("checkout-form");
    if (!form) {
      return;
    }

    const formData = new FormData(form);
    const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];

    if (!cartItems.length) {
      return;
    }

    const collectionIds = cartItems.map(item => item.collection_id).join(", ");
    const productIds = cartItems
      .flatMap(item => item.includedProducts.map(p => p.product_id))
      .join(", ");

    const orderDetails = cartItems.map((item, idx) => {
      return `Collection ${idx + 1} - ${item.title} (${item.category}) (ID: ${item.collection_id})
  Clothing Size: ${item.clothingSize || "N/A"}
  Shoe Size: ${item.shoeSize || "N/A"}
  ${item.includedProducts.map((p, i) => `  Product ${i + 1} (ID: ${p.product_id}) - ₹${p.price}`).join("\n")}`;
    }).join("\n\n");

    const data = {
      name: formData.get("name"),
      email: formData.get("email"),
      phone: formData.get("phone"),
      instagram: formData.get("instagram"),
      address: formData.get("address"),
      collectionIds,
      productIds,
      order: orderDetails,
      total: totalAmount
    };


    emailjs.send("service_ytjw67v", "template_0wdcbd6", data)
      .then(() => {
        localStorage.removeItem("cartItems");
        window.location.href = "confirmation.html";
      })
      .catch(err => {
        showToast("There was an error sending your order, if the payment is complete don't worry, just reach out to us on Instagram or WhatsApp and we will help you out!", "msg");
      });
  }

  function showToast(message, type = "error") {
    const toast = document.createElement("div");
    toast.className = `
      relative max-w-md w-full mx-auto mb-4 px-4 py-3 rounded-lg shadow-lg text-white flex justify-between items-start gap-4
      ${type === "error" ? "bg-red-500 bg-opacity-90" : "bg-green-500 bg-opacity-90"} 
      animate-fade-in-down`;

    toast.innerHTML = `
      <span class="flex-1">${message}</span>
      <button class="ml-4 text-xl leading-none focus:outline-none" onclick="this.parentElement.remove()">×</button>
    `;

    const container = document.getElementById("toast-container");
    container.appendChild(toast);

    setTimeout(() => {
      toast.classList.add("opacity-0");
      setTimeout(() => toast.remove(), 300);
    }, 5000);
  }
</script>

<div id="toast-container" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-xl flex flex-col items-center space-y-2"></div>

</body>
</html>
